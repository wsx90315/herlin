define(["module"],function(e){"use strict";function t(e){return l.parseFromString("<body>"+e+"</body>","text/html").querySelector("body")}function r(e,t){e.each(function(e,r){var n=r.getAttribute("href");n&&t.deps.push(a(n,t.moduleId+"/../")),g(r).remove()})}function n(e,t){var r,n,i,o=[],u={},c={context:"gk"};if(e.each(function(e,r){var n=r.getAttribute("src");n?o.push(a(n,t.moduleId+"/../")):t.script+=g(r).text()}),i=o.length,i&&(t.deps.push(o[i-1]),i>1)){for(var l=i-1;l>0;l-=1)u[o[l]]=[o[l-1]];try{r=requirejs.s.contexts.gk.config.shim,g.each(u,function(e,t){n=r[e]&&r[e].deps||[],u[e]=t.concat(n)})}catch(s){}c.shim=u,t.script="requirejs.config("+JSON.stringify(c)+");"+t.script}}function i(e,t){var n=g("<div>"+e.html()+"</div>");r(n.find("link"),t),t.template=f(p(n.html())),e.html(n.html())}function o(e,t){t.moduleText=x.requireVariables(t.deps)+";"+x.registerElement(t.template)+(e.length?e.text():"")}function u(e){return"(function(){"+x.moduleInfo(e.moduleId)+";"+p(e.script)+";define(function("+e.vars.join()+"){"+e.moduleText+"})}());"}function c(e,c){var l=t(e),s=g(l),m=s.find("link"),d=s.children("script"),a=s.children("element").first(),f=a.children("template").first(),p=a.children("script");return r(m,c),n(d,c),i(f,c),o(p,c),u(c)}var l=new window.DOMParser;!function(e){var t=window.DOMParser.prototype.parseFromString;try{if(e.parseFromString("","text/html"))return}catch(r){}e.parseFromString=function(e,r){if(/^\s*text\/html\s*(?:;|$)/i.test(r)){var n=document.implementation.createHTMLDocument("");return e.toLowerCase().indexOf("<!doctype")>-1?n.documentElement.innerHTML=e:n.body.innerHTML=e,n}return t.apply(this,arguments)}}(l);var s=".html",m=e.config(),d=m.lib,a=d.loadUrl,f=d.trimHtml,p=d.trimNewline,h=d.each,g=d.$,v=g.gk,x={requireVariables:function(e){var t=[];return h(e,function(e){t.push('require("'+e+'")')}),t.join(";")},registerElement:function(e){return"function registerElement(n,c){$.gk.registerElement(n,'"+e+"',c)}"},moduleInfo:function(e){return"var module="+JSON.stringify({id:e})}};return v.registerElement=function(e,t,r){v.registry(e,{template:t,script:function(){for(var e=Object.keys(r||{}),t=0,n=e.length;n>t;t+=1)this[e[t]]=r[e[t]]}})},{load:function(e,t,r){t(["@text!"+e+s],function(t){var n={deps:[],vars:["require","exports","module"],moduleId:e,template:"",moduleText:"",script:""};r.fromText(c(t,n))})},pluginBuilder:"./html-build"}});